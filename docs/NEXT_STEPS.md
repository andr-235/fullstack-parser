# üöÄ –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏ –¥–ª—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã

## üìã –ü–ª–∞–Ω —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ –ø–æ —ç—Ç–∞–ø–∞–º

### üéØ –≠—Ç–∞–ø 1: –°–æ–∑–¥–∞–Ω–∏–µ –±–∞–∑–æ–≤—ã—Ö –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤ (1-2 –Ω–µ–¥–µ–ª–∏)

#### Backend (FastAPI)
```bash
# –°–æ–∑–¥–∞—Ç—å —Å—Ç—Ä—É–∫—Ç—É—Ä—É backend
mkdir -p backend/{app/{api/v1,core,models,schemas,services,db,utils},tests,alembic}

# –û—Å–Ω–æ–≤–Ω—ã–µ —Ñ–∞–π–ª—ã –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è:
backend/
‚îú‚îÄ‚îÄ Dockerfile              # Multi-stage –¥–ª—è dev/prod
‚îú‚îÄ‚îÄ requirements.txt         # Python –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
‚îú‚îÄ‚îÄ app/
‚îÇ   ‚îú‚îÄ‚îÄ main.py             # FastAPI app initialization
‚îÇ   ‚îú‚îÄ‚îÄ core/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ config.py       # Settings —á–µ—Ä–µ–∑ pydantic
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ security.py     # JWT, OAuth2, authentication
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ database.py     # SQLAlchemy setup
‚îÇ   ‚îú‚îÄ‚îÄ api/v1/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ auth.py         # Authentication endpoints
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ users.py        # User management
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ health.py       # Health check endpoint
‚îÇ   ‚îú‚îÄ‚îÄ models/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ user.py         # SQLAlchemy User model
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ base.py         # Base model class
‚îÇ   ‚îú‚îÄ‚îÄ schemas/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ user.py         # Pydantic schemas
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ auth.py         # Auth schemas
‚îÇ   ‚îî‚îÄ‚îÄ services/
‚îÇ       ‚îú‚îÄ‚îÄ auth_service.py # Business logic
‚îÇ       ‚îî‚îÄ‚îÄ user_service.py # User operations
```

#### Frontend (Next.js)
```bash
# –°–æ–∑–¥–∞—Ç—å —Å—Ç—Ä—É–∫—Ç—É—Ä—É frontend
mkdir -p frontend/src/{app,components,hooks,lib,services,types}

# –û—Å–Ω–æ–≤–Ω—ã–µ —Ñ–∞–π–ª—ã –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è:
frontend/
‚îú‚îÄ‚îÄ Dockerfile              # Multi-stage –¥–ª—è dev/prod
‚îú‚îÄ‚îÄ package.json            # Node.js –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
‚îú‚îÄ‚îÄ next.config.js          # Next.js configuration
‚îú‚îÄ‚îÄ tailwind.config.js      # TailwindCSS setup
‚îú‚îÄ‚îÄ src/
‚îÇ   ‚îú‚îÄ‚îÄ app/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ layout.tsx      # Root layout
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ page.tsx        # Home page
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ login/          # Authentication pages
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ dashboard/      # Protected pages
‚îÇ   ‚îú‚îÄ‚îÄ components/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ ui/             # Reusable UI components
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ auth/           # Auth components
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ layout/         # Layout components
‚îÇ   ‚îú‚îÄ‚îÄ hooks/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ useAuth.ts      # Authentication hook
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ useApi.ts       # API calls hook
‚îÇ   ‚îú‚îÄ‚îÄ lib/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ auth.ts         # Auth utilities
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ api.ts          # API client
‚îÇ   ‚îî‚îÄ‚îÄ services/
‚îÇ       ‚îî‚îÄ‚îÄ authService.ts  # API calls
```

### üéØ –≠—Ç–∞–ø 2: –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä–∏–∑–∞—Ü–∏—è –∏ –ª–æ–∫–∞–ª—å–Ω–∞—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∞ (3-5 –¥–Ω–µ–π)

1. **–°–æ–∑–¥–∞—Ç—å Dockerfiles**
   - Multi-stage builds –¥–ª—è –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏
   - –û—Ç–¥–µ–ª—å–Ω—ã–µ targets –¥–ª—è development/production

2. **–ù–∞—Å—Ç—Ä–æ–∏—Ç—å docker-compose –¥–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏**
   - Hot reload –¥–ª—è –±—ã—Å—Ç—Ä–æ–π –∏—Ç–µ—Ä–∞—Ü–∏–∏
   - Volume mapping –¥–ª—è live updates
   - Environment variables

3. **–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –ª–æ–∫–∞–ª—å–Ω–æ**
   ```bash
   # –ó–∞–ø—É—Å–∫ –¥–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏
   docker-compose up -d
   
   # –ü—Ä–æ–≤–µ—Ä–∫–∞ —á—Ç–æ –≤—Å–µ —Ä–∞–±–æ—Ç–∞–µ—Ç
   curl http://localhost:8000/health
   curl http://localhost:3000
   ```

### üéØ –≠—Ç–∞–ø 3: –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ —Å–µ—Ä–≤–µ—Ä–∞ Debian 12 (1-2 –¥–Ω—è)

1. **–ó–∞–ø—É—Å—Ç–∏—Ç—å setup —Å–∫—Ä–∏–ø—Ç**
   ```bash
   # –ù–∞ —Å–µ—Ä–≤–µ—Ä–µ
   wget https://raw.githubusercontent.com/your-repo/arc/main/scripts/setup-server.sh
   chmod +x setup-server.sh
   sudo ./setup-server.sh yourdomain.com your-email@domain.com
   ```

2. **–ü—Ä–æ–≤–µ—Ä–∏—Ç—å –Ω–∞—Å—Ç—Ä–æ–π–∫–∏**
   ```bash
   # –ü—Ä–æ–≤–µ—Ä–∏—Ç—å Docker
   docker --version
   docker-compose --version
   
   # –ü—Ä–æ–≤–µ—Ä–∏—Ç—å firewall
   sudo ufw status
   
   # –ü—Ä–æ–≤–µ—Ä–∏—Ç—å SSL
   sudo certbot certificates
   ```

### üéØ –≠—Ç–∞–ø 4: Production –¥–µ–ø–ª–æ–π (2-3 –¥–Ω—è)

1. **–ü–æ–¥–≥–æ—Ç–æ–≤–∏—Ç—å production –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é**
   ```bash
   # –°–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å –∏ –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å .env.prod
   cp env.example .env.prod
   # –û—Ç—Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å —Å production –∑–Ω–∞—á–µ–Ω–∏—è–º–∏
   ```

2. **–ü–µ—Ä–≤—ã–π –¥–µ–ø–ª–æ–π**
   ```bash
   # –ö–ª–æ–Ω–∏—Ä–æ–≤–∞—Ç—å –ø—Ä–æ–µ–∫—Ç –Ω–∞ —Å–µ—Ä–≤–µ—Ä
   git clone your-repo /opt/app
   cd /opt/app
   
   # –ó–∞–ø—É—Å—Ç–∏—Ç—å –¥–µ–ø–ª–æ–π
   ./scripts/deploy.sh main
   ```

3. **–ù–∞—Å—Ç—Ä–æ–∏—Ç—å Nginx –¥–ª—è –¥–æ–º–µ–Ω–∞**
   - –û–±–Ω–æ–≤–∏—Ç—å nginx/nginx.prod.conf —Å –≤–∞—à–∏–º –¥–æ–º–µ–Ω–æ–º
   - –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å Nginx

### üéØ –≠—Ç–∞–ø 5: –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ (1-2 –¥–Ω—è)

1. **–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ**
   - Unit —Ç–µ—Å—Ç—ã (backend/frontend)
   - Integration —Ç–µ—Å—Ç—ã
   - E2E —Ç–µ—Å—Ç—ã —Å Playwright

2. **–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥**
   - Health checks
   - Log aggregation
   - Performance monitoring

## üõ†Ô∏è –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –¥–µ—Ç–∞–ª–∏ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏

### Backend Dependencies (requirements.txt)
```txt
fastapi==0.104.1
uvicorn[standard]==0.24.0
sqlalchemy==2.0.23
alembic==1.12.1
psycopg2-binary==2.9.9
redis==5.0.1
python-jose[cryptography]==3.3.0
passlib[bcrypt]==1.7.4
python-multipart==0.0.6
pydantic[email]==2.5.0
pytest==7.4.3
pytest-asyncio==0.21.1
httpx==0.25.2
```

### Frontend Dependencies (package.json)
```json
{
  "dependencies": {
    "next": "14.0.3",
    "react": "18.2.0",
    "react-dom": "18.2.0",
    "typescript": "5.3.2",
    "@types/react": "18.2.42",
    "@types/react-dom": "18.2.17",
    "tailwindcss": "3.3.6",
    "zod": "3.22.4",
    "react-hook-form": "7.48.2",
    "@tanstack/react-query": "5.8.4",
    "axios": "1.6.2"
  },
  "devDependencies": {
    "jest": "29.7.0",
    "@testing-library/react": "14.1.2",
    "eslint": "8.54.0",
    "prettier": "3.1.0",
    "playwright": "1.40.1"
  }
}
```

### Environment Variables (.env.prod example)
```bash
# Database
DB_NAME=prod_app
DB_USER=appuser
DB_PASSWORD=secure_password_here
DB_HOST=postgres

# Redis
REDIS_URL=redis://redis:6379/0

# Security
SECRET_KEY=super-secure-secret-key-for-production
JWT_SECRET_KEY=jwt-secret-key-for-production

# URLs
FRONTEND_URL=https://yourdomain.com
CORS_ORIGINS=https://yourdomain.com

# Email (optional)
SMTP_HOST=smtp.gmail.com
SMTP_USER=your-email@gmail.com
SMTP_PASSWORD=your-app-password
```

## üîí Security Checklist

- [ ] –í—Å–µ secrets –≤ environment variables
- [ ] JWT —Ç–æ–∫–µ–Ω—ã —Å –∫–æ—Ä–æ—Ç–∫–∏–º —Å—Ä–æ–∫–æ–º –∂–∏–∑–Ω–∏
- [ ] Rate limiting –Ω–∞ API endpoints
- [ ] CORS –ø—Ä–∞–≤–∏–ª—å–Ω–æ –Ω–∞—Å—Ç—Ä–æ–µ–Ω
- [ ] SSL —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç—ã —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã
- [ ] Firewall –Ω–∞—Å—Ç—Ä–æ–µ–Ω (—Ç–æ–ª—å–∫–æ 22, 80, 443)
- [ ] Fail2ban –∞–∫—Ç–∏–≤–µ–Ω
- [ ] Input validation —á–µ—Ä–µ–∑ Pydantic
- [ ] SQL injection protection
- [ ] XSS protection headers

## üöÄ CI/CD Setup (GitHub Actions)

–°–æ–∑–¥–∞—Ç—å `.github/workflows/deploy.yml`:
```yaml
name: Deploy to Production

on:
  push:
    branches: [ main ]

jobs:
  deploy:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      
      - name: Deploy to server
        uses: appleboy/ssh-action@v1.0.0
        with:
          host: ${{ secrets.HOST }}
          username: ${{ secrets.USERNAME }}
          key: ${{ secrets.PRIVATE_KEY }}
          script: |
            cd /opt/app
            ./scripts/deploy.sh main --force
```

## üìä –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∏ Maintenance

### –ï–∂–µ–¥–Ω–µ–≤–Ω—ã–µ –∑–∞–¥–∞—á–∏
- –ü—Ä–æ–≤–µ—Ä–∫–∞ –ª–æ–≥–æ–≤: `docker-compose -f docker-compose.prod.yml logs --tail=100`
- –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ —Ä–µ—Å—É—Ä—Å–æ–≤: `docker stats`
- –ü—Ä–æ–≤–µ—Ä–∫–∞ health checks

### –ï–∂–µ–Ω–µ–¥–µ–ª—å–Ω—ã–µ –∑–∞–¥–∞—á–∏
- –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π
- –ü—Ä–æ–≤–µ—Ä–∫–∞ security updates
- –ê–Ω–∞–ª–∏–∑ performance metrics

### –ï–∂–µ–º–µ—Å—è—á–Ω—ã–µ –∑–∞–¥–∞—á–∏
- –†–æ—Ç–∞—Ü–∏—è SSL —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–æ–≤ (–∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏)
- –û—á–∏—Å—Ç–∫–∞ —Å—Ç–∞—Ä—ã—Ö Docker images
- Backup verification

## üìû –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –∏ Troubleshooting

### –ß–∞—Å—Ç—ã–µ –ø—Ä–æ–±–ª–µ–º—ã
1. **–ö–æ–Ω—Ç–µ–π–Ω–µ—Ä –Ω–µ –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è**
   ```bash
   docker-compose -f docker-compose.prod.yml logs [service]
   ```

2. **SSL –ø—Ä–æ–±–ª–µ–º—ã**
   ```bash
   sudo certbot renew --dry-run
   ```

3. **Database connectivity**
   ```bash
   docker-compose -f docker-compose.prod.yml exec postgres psql -U $DB_USER -d $DB_NAME
   ```

4. **High memory usage**
   ```bash
   docker stats
   docker system prune -f
   ```

### –ü–æ–ª–µ–∑–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã
```bash
# –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫ –≤—Å–µ—Ö —Å–µ—Ä–≤–∏—Å–æ–≤
docker-compose -f docker-compose.prod.yml restart

# Backup –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö
./scripts/backup.sh full

# –ü—Ä–æ—Å–º–æ—Ç—Ä –ª–æ–≥–æ–≤ –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏
docker-compose -f docker-compose.prod.yml logs -f

# –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –¥–æ –Ω–æ–≤–æ–π –≤–µ—Ä—Å–∏–∏
./scripts/deploy.sh main
```

---

## üéØ –°–ª–µ–¥—É—é—â–∏–π –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç

1. **–°–æ–∑–¥–∞—Ç—å –±–∞–∑–æ–≤—É—é —Å—Ç—Ä—É–∫—Ç—É—Ä—É –ø—Ä–æ–µ–∫—Ç–æ–≤** (backend/frontend)
2. **–ù–∞—Å—Ç—Ä–æ–∏—Ç—å –ª–æ–∫–∞–ª—å–Ω—É—é —Ä–∞–∑—Ä–∞–±–æ—Ç–∫—É** —Å Docker
3. **–ü–æ–¥–≥–æ—Ç–æ–≤–∏—Ç—å —Å–µ—Ä–≤–µ—Ä** —Å –ø–æ–º–æ—â—å—é setup-server.sh
4. **–ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –¥–µ–ø–ª–æ–π** –≤ staging –æ–∫—Ä—É–∂–µ–Ω–∏–∏
5. **–ó–∞–ø—É—Å—Ç–∏—Ç—å –≤ production** üöÄ

**–£–¥–∞—á–∏ —Å —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–µ–π! üéâ** 

# –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏ –ø–æ —Ä–∞–∑–≤–∏—Ç–∏—é –ø—Ä–æ–µ–∫—Ç–∞

## 1. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ VK API –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏

### –ü–æ–ª—É—á–µ–Ω–∏–µ –≤–∞–ª–∏–¥–Ω–æ–≥–æ VK API —Ç–æ–∫–µ–Ω–∞

–î–ª—è –ø–æ–ª–Ω–æ—Ü–µ–Ω–Ω–æ–π —Ä–∞–±–æ—Ç—ã –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å –≤–∞–ª–∏–¥–Ω—ã–π VK API —Ç–æ–∫–µ–Ω. –¢–µ–∫—É—â–∏–π —Ç–æ–∫–µ–Ω-–∑–∞–ø–æ–ª–Ω–∏—Ç–µ–ª—å –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç –∏ –≤—ã–∑—ã–≤–∞–µ—Ç –æ—à–∏–±–∫—É –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏:

```
ERROR: User authorization failed: invalid access_token (4)
```

#### –®–∞–≥–∏ –¥–ª—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∏:

1. –°–ª–µ–¥—É–π—Ç–µ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è–º –≤ –¥–æ–∫—É–º–µ–Ω—Ç–µ [docs/VK_API_SETUP.md](VK_API_SETUP.md)
2. –°–æ–∑–¥–∞–π—Ç–µ Standalone-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –í–ö–æ–Ω—Ç–∞–∫—Ç–µ
3. –ü–æ–ª—É—á–∏—Ç–µ —Ç–æ–∫–µ–Ω —Å –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–º–∏ —Ä–∞–∑—Ä–µ—à–µ–Ω–∏—è–º–∏ (scope):
   - `groups` - –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –≥—Ä—É–ø–ø–∞–º–∏
   - `wall` - –¥–ª—è –¥–æ—Å—Ç—É–ø–∞ –∫ —Å—Ç–µ–Ω–∞–º –≥—Ä—É–ø–ø 
   - `offline` - –¥–ª—è –ø–æ—Å—Ç–æ—è–Ω–Ω–æ–≥–æ –¥–æ—Å—Ç—É–ø–∞

4. –û–±–Ω–æ–≤–∏—Ç–µ —Ñ–∞–π–ª `.env` —Å –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–º —Ç–æ–∫–µ–Ω–æ–º:
   ```
   VK_ACCESS_TOKEN=–≤–∞—à_–ø–æ–ª—É—á–µ–Ω–Ω—ã–π_—Ç–æ–∫–µ–Ω
   ```

5. –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–µ backend –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä:
   ```
   docker-compose restart backend
   ```

### –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏

–ü–æ—Å–ª–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –≤–∞–ª–∏–¥–Ω–æ–≥–æ —Ç–æ–∫–µ–Ω–∞:
1. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –¥–æ–±–∞–≤–∏—Ç—å –≥—Ä—É–ø–ø—É —á–µ—Ä–µ–∑ API:
   ```
   curl -X POST -H "Content-Type: application/json" -d '{"vk_id_or_screen_name": "ria", "screen_name": "ria", "name": "–†–ò–ê –ù–æ–≤–æ—Å—Ç–∏"}' http://localhost:8000/api/v1/groups/
   ```

2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —á–µ—Ä–µ–∑ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ –≥—Ä—É–ø–ø—ã –≤ —Ä–∞–∑–¥–µ–ª–µ "–ì—Ä—É–ø–ø—ã"
3. –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä—É–π—Ç–µ –ø–∞—Ä—Å–∏–Ω–≥ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–µ–≤

## 2. –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏

- –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ VK API –∑–∞–ø—Ä–æ—Å–æ–≤ —á–µ—Ä–µ–∑ Redis
- –û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞—Ç—å –∑–∞–ø—Ä–æ—Å—ã –∫ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö
- –î–æ–±–∞–≤–∏—Ç—å –∏–Ω–¥–µ–∫—Å—ã –¥–ª—è —á–∞—Å—Ç—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤

## 3. –†–∞—Å—à–∏—Ä–µ–Ω–∏–µ —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç–∏

- –î–æ–±–∞–≤–∏—Ç—å –ø–æ–¥–¥–µ—Ä–∂–∫—É –¥—Ä—É–≥–∏—Ö —Ç–∏–ø–æ–≤ –≤–ª–æ–∂–µ–Ω–∏–π
- –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å —Ä–∞—Å–ø–∏—Å–∞–Ω–∏–µ –ø–∞—Ä—Å–∏–Ω–≥–∞
- –î–æ–±–∞–≤–∏—Ç—å –≤—ã–≥—Ä—É–∑–∫—É —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ –≤ CSV/Excel

## 4. –£–ª—É—á—à–µ–Ω–∏–µ UI

- –î–æ–±–∞–≤–∏—Ç—å —Ç–µ–º–Ω—É—é —Ç–µ–º—É
- –£–ª—É—á—à–∏—Ç—å –º–æ–±–∏–ª—å–Ω—É—é –≤–µ—Ä—Å–∏—é
- –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –∏–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω—ã–µ –¥–∞—à–±–æ—Ä–¥—ã

## 5. –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

- –ù–∞—Å—Ç—Ä–æ–∏—Ç—å —Å–∏—Å—Ç–µ–º—É –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏
- –î–æ–±–∞–≤–∏—Ç—å –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ –¥–æ—Å—Ç—É–ø–∞ –∫ API
- –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –∞—É–¥–∏—Ç –¥–µ–π—Å—Ç–≤–∏–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π 

## –î–µ—Ç–∞–ª–∏–∑–∞—Ü–∏—è –ø–ª–∞–Ω–æ–≤ –Ω–∞ –±—É–¥—É—â–µ–µ —Ä–∞–∑–≤–∏—Ç–∏–µ

### 1. –î–æ–±–∞–≤–∏—Ç—å –ø–∞—Ä—Å–∏–Ω–≥ –ø–æ –≤—Å–µ–º –≥—Ä—É–ø–ø–∞–º

**–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞:**
- Endpoint `/parse_all_groups` (–¥–æ—Å—Ç—É–ø–µ–Ω –≤—Å–µ–º) .
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –æ—á–µ—Ä–µ–¥–∏ –∑–∞–¥–∞—á (Arq) –¥–ª—è –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ–≥–æ –ø–∞—Ä—Å–∏–Ω–≥–∞ –≥—Ä—É–ø–ø.
- –ö–∞–∂–¥–∞—è –∑–∞–¥–∞—á–∞ –ø–∞—Ä—Å–∏–Ω–≥–∞ –≥—Ä—É–ø–ø—ã ‚Äî –æ—Ç–¥–µ–ª—å–Ω–∞—è Arq task.

**–¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –¥–µ—Ç–∞–ª–∏:**
- –ü–æ–ª—É—á–∏—Ç—å —Å–ø–∏—Å–æ–∫ –≤—Å–µ—Ö –∞–∫—Ç–∏–≤–Ω—ã—Ö –≥—Ä—É–ø–ø –∏–∑ –ë–î: `SELECT * FROM vk_groups WHERE is_active = true`.
- –î–ª—è –∫–∞–∂–¥–æ–π –≥—Ä—É–ø–ø—ã —Å–æ–∑–¥–∞—Ç—å –∑–∞–¥–∞—á—É: `arq.enqueue(parse_group, group_id=...)`.
- –û–≥—Ä–∞–Ω–∏—á–∏—Ç—å –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∑–∞–¥–∞—á (rate limit, max concurrency).
- –õ–æ–≥–∏—Ä–æ–≤–∞—Ç—å —Å—Ç–∞—Ç—É—Å –∫–∞–∂–¥–æ–π –∑–∞–¥–∞—á–∏ (—É—Å–ø–µ—Ö/–æ—à–∏–±–∫–∞, –≤—Ä–µ–º—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è).

**–ü—Ä–∏–º–µ—Ä API:**
```http
POST /parse_all_groups
```
–û—Ç–≤–µ—Ç: `{ "status": "started", "groups": 123 }`

**–í–æ–∑–º–æ–∂–Ω—ã–µ —Å–ª–æ–∂–Ω–æ—Å—Ç–∏:**
- –°–ª–∏—à–∫–æ–º –º–Ω–æ–≥–æ –≥—Ä—É–ø–ø ‚Äî –Ω–∞–≥—Ä—É–∑–∫–∞ –Ω–∞ VK API, –ª–∏–º–∏—Ç—ã.
- –û—à–∏–±–∫–∏ VK API –Ω–µ –¥–æ–ª–∂–Ω—ã –æ—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞—Ç—å –æ–±—â–∏–π –ø—Ä–æ—Ü–µ—Å—Å.
- –ù–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç—å –ø–æ–≤—Ç–æ—Ä–Ω—ã—Ö –ø–æ–ø—ã—Ç–æ–∫ –¥–ª—è —É–ø–∞–≤—à–∏—Ö –∑–∞–¥–∞—á.

### 2. –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∏ –ø–∞—Ä—Å–∏–Ω–≥ –ø–æ—Å—Ç–æ—è–Ω–Ω—ã–π –≤—Å–µ—Ö –≥—Ä—É–ø–ø, –∫–æ—Ç–æ—Ä—ã–µ –µ—Å—Ç—å –≤ –ë–î

**–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞:**
- –§–æ–Ω–æ–≤—ã–π —Å–µ—Ä–≤–∏—Å –Ω–∞ Arq, –∑–∞–ø—É—Å–∫–∞—é—â–∏–π—Å—è –ø–æ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—é (–∫–∞–∂–¥—ã–µ N –º–∏–Ω—É—Ç).
- –î–ª—è –∫–∞–∂–¥–æ–π –≥—Ä—É–ø–ø—ã —Å–æ–∑–¥–∞—ë—Ç—Å—è –∑–∞–¥–∞—á–∞ –ø–∞—Ä—Å–∏–Ω–≥–∞ (—Å–º. –≤—ã—à–µ).
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å cron-like —Ä–∞—Å–ø–∏—Å–∞–Ω–∏–µ Arq –∏–ª–∏ –æ—Ç–¥–µ–ª—å–Ω—ã–π –ø–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫ (–Ω–∞–ø—Ä–∏–º–µ—Ä, APScheduler).

**–¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –¥–µ—Ç–∞–ª–∏:**
- –¢–∞–±–ª–∏—Ü–∞ `vk_groups` ‚Äî –¥–æ–±–∞–≤–∏—Ç—å –ø–æ–ª–µ `priority` (int) –∏ `last_parsed_at` (datetime).
- –ì—Ä—É–ø–ø—ã —Å –≤—ã—Å–æ–∫–∏–º –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–æ–º –ø–∞—Ä—Å—è—Ç—Å—è —á–∞—â–µ (–Ω–∞–ø—Ä–∏–º–µ—Ä, priority=10 ‚Äî –∫–∞–∂–¥—ã–µ 10 –º–∏–Ω—É—Ç, priority=1 ‚Äî —Ä–∞–∑ –≤ —á–∞—Å).
- –•—Ä–∞–Ω–∏—Ç—å –ª–æ–≥–∏ –∑–∞–ø—É—Å–∫–æ–≤ –∏ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –≤ —Ç–∞–±–ª–∏—Ü–µ `parsing_logs` (group_id, status, started_at, finished_at, error_message).
- –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –º–µ—Ö–∞–Ω–∏–∑–º –ø–æ–≤—Ç–æ—Ä–Ω—ã—Ö –ø–æ–ø—ã—Ç–æ–∫ (retry) –¥–ª—è –Ω–µ—É—Å–ø–µ—à–Ω—ã—Ö –∑–∞–¥–∞—á.

**–ü—Ä–∏–º–µ—Ä –∫–æ–¥–∞ (Arq):**
```python
from arq import create_pool
from app.services.parser_service import parse_group

async def periodic_parsing(ctx):
    groups = await get_groups_to_parse()
    for group in groups:
        await ctx['arq_pool'].enqueue_job('parse_group', group_id=group.id)
```

**–í–æ–∑–º–æ–∂–Ω—ã–µ —Å–ª–æ–∂–Ω–æ—Å—Ç–∏:**
- VK API rate limits ‚Äî –Ω—É–∂–Ω–æ —Ä–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å backoff –∏ –æ—á–µ—Ä–µ–¥–∏.
- –î–æ–ª–≥–∏–µ –∑–∞–¥–∞—á–∏ ‚Äî –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ "–∑–∞–≤–∏—Å—à–∏—Ö" –∑–∞–¥–∞—á.
- –°–±–æ–∏ –ë–î –∏–ª–∏ —Å–µ—Ç–∏ ‚Äî –ø–æ–≤—Ç–æ—Ä–Ω—ã–µ –ø–æ–ø—ã—Ç–∫–∏.

### 3. –í–≤–µ—Å—Ç–∏ –≥—Ä–∞–¥–∞—Ü–∏—é –≥—Ä—É–ø–ø: –º–æ–π —Ä–µ–≥–∏–æ–Ω –∏ –æ—Å—Ç–∞–ª—å–Ω—ã–µ —Ä–µ–≥–∏–æ–Ω—ã

**–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞:**
- –í —Ç–∞–±–ª–∏—Ü—É `vk_groups` –¥–æ–±–∞–≤–∏—Ç—å –ø–æ–ª–µ `region` (—Å—Ç—Ä–æ–∫–∞ –∏–ª–∏ enum).
- –í –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–µ –∏ API –¥–æ–±–∞–≤–∏—Ç—å —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—é –ø–æ —Ä–µ–≥–∏–æ–Ω—É.
- –î–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π ‚Äî —Ç–∞–±–ª–∏—Ü–∞ `user_regions` (user_id, region_code) –¥–ª—è –ø–µ—Ä—Å–æ–Ω–∞–ª–∏–∑–∞—Ü–∏–∏.

**–¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –¥–µ—Ç–∞–ª–∏:**
- –ü—Ä–∏ –¥–æ–±–∞–≤–ª–µ–Ω–∏–∏/—Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–∏ –≥—Ä—É–ø–ø—ã —É–∫–∞–∑—ã–≤–∞—Ç—å —Ä–µ–≥–∏–æ–Ω.
- –í API –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –≥—Ä—É–ø–ø –∏ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–µ–≤ –¥–æ–±–∞–≤–∏—Ç—å –ø–∞—Ä–∞–º–µ—Ç—Ä `region`.
- –í —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è—Ö –∏ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–µ –≤—ã–¥–µ–ª—è—Ç—å "—Å–≤–æ–∏" —Ä–µ–≥–∏–æ–Ω—ã.

**–ü—Ä–∏–º–µ—Ä API:**
```http
GET /api/v1/groups?region=amur
GET /api/v1/comments?region=amur
```

**–í–æ–∑–º–æ–∂–Ω—ã–µ —Å–ª–æ–∂–Ω–æ—Å—Ç–∏:**
- –ù–µ–æ–¥–Ω–æ–∑–Ω–∞—á–Ω–æ—Å—Ç—å —Ä–µ–≥–∏–æ–Ω–æ–≤ (—Ä–∞–∑–Ω—ã–µ –Ω–∞–∑–≤–∞–Ω–∏—è, –∫–æ–¥—ã) ‚Äî –Ω—É–∂–µ–Ω —Å–ø—Ä–∞–≤–æ—á–Ω–∏–∫.
- –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –º–æ–∂–µ—Ç –≤—ã–±—Ä–∞—Ç—å –Ω–µ—Å–∫–æ–ª—å–∫–æ —Ä–µ–≥–∏–æ–Ω–æ–≤ ‚Äî –Ω—É–∂–Ω–∞ –ø–æ–¥–¥–µ—Ä–∂–∫–∞ –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω–æ–≥–æ –≤—ã–±–æ—Ä–∞.

### 4. –£–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –æ –Ω–∞–π–¥–µ–Ω–Ω—ã—Ö –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏—è—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é –≤ Telegram

**–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞:**
- Telegram-–±–æ—Ç –Ω–∞ aiogram –∏–ª–∏ pyTelegramBotAPI.
- –¢–∞–±–ª–∏—Ü–∞ `user_telegram` (user_id, telegram_id, is_active).
- –ü—Ä–∏ –Ω–∞—Ö–æ–∂–¥–µ–Ω–∏–∏ –Ω–æ–≤–æ–≥–æ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏—è ‚Äî –æ—Ç–ø—Ä–∞–≤–∫–∞ —Å–æ–æ–±—â–µ–Ω–∏—è —á–µ—Ä–µ–∑ Telegram API.

**–¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –¥–µ—Ç–∞–ª–∏:**
- –•—Ä–∞–Ω–∏—Ç—å —à–∞–±–ª–æ–Ω —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è (Jinja2): —Ç–µ–∫—Å—Ç, –≥—Ä—É–ø–ø–∞, —Å—Å—ã–ª–∫–∞, –∫–ª—é—á–µ–≤—ã–µ —Å–ª–æ–≤–∞.
- –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –∫–æ–º–∞–Ω–¥ /start, /stop, /status –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –ø–æ–¥–ø–∏—Å–∫–æ–π.
- –õ–æ–≥–∏—Ä–æ–≤–∞—Ç—å –≤—Å–µ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è (user_id, comment_id, sent_at, status).
- –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ Telegram API (rate limit, –±–ª–æ–∫–∏—Ä–æ–≤–∫–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è).

**–ü—Ä–∏–º–µ—Ä —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è:**
```
–ù–∞–π–¥–µ–Ω –Ω–æ–≤—ã–π –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π!
–ì—Ä—É–ø–ø–∞: LIVE –ë–∏—Ä–æ–±–∏–¥–∂–∞–Ω
–¢–µ–∫—Å—Ç: "–ö–æ–Ω—Ç—Ä–∞–∫—Ç–Ω–∞—è —Å–ª—É–∂–±–∞ ‚Äî —ç—Ç–æ –∑–∞—â–∏—Ç–∞ –Ω–∞—à–µ–π –†–æ–¥–∏–Ω—ã..."
–ö–ª—é—á–µ–≤—ã–µ —Å–ª–æ–≤–∞: —Å–ª—É–∂–±–∞, –†–æ–¥–∏–Ω–∞
–°—Å—ã–ª–∫–∞: https://vk.com/wall-40023088_306757?reply=306760
```

**–í–æ–∑–º–æ–∂–Ω—ã–µ —Å–ª–æ–∂–Ω–æ—Å—Ç–∏:**
- –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–ª –±–æ—Ç–∞ ‚Äî –Ω—É–∂–Ω–æ –æ—Ç–ø–∏—Å—ã–≤–∞—Ç—å.
- Telegram rate limits ‚Äî —Ä–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –æ—á–µ—Ä–µ–¥—å –æ—Ç–ø—Ä–∞–≤–∫–∏.
- –ú–∞—Å—Å–æ–≤—ã–µ —Ä–∞—Å—Å—ã–ª–∫–∏ ‚Äî –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞—Ç—å –æ—Ç–ø—Ä–∞–≤–∫—É (batching, throttling). 

## –ü—Ä–∏–Ω—Ü–∏–ø—ã –¥–æ—Å—Ç—É–ø–∞ –∏ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏

- –í –ø—Ä–æ–µ–∫—Ç–µ **–Ω–µ—Ç —Ä–∞–∑–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è —Ä–æ–ª–µ–π**: –≤—Å–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ (–≤—ã –∏ –≤–∞—à –Ω–∞–ø–∞—Ä–Ω–∏–∫) –æ–±–ª–∞–¥–∞—é—Ç –ø–æ–ª–Ω—ã–º –¥–æ—Å—Ç—É–ø–æ–º –∫–æ –≤—Å–µ–º —Ñ—É–Ω–∫—Ü–∏—è–º —Å–∏—Å—Ç–µ–º—ã.
- –í—Å–µ endpoints –∏ —Å–µ—Ä–≤–∏—Å–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ –¥–æ—Å—Ç—É–ø–Ω—ã –¥–ª—è –ª—é–±–æ–≥–æ —É—á–∞—Å—Ç–Ω–∏–∫–∞ –∫–æ–º–∞–Ω–¥—ã **–±–µ–∑ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–π**.
- –ù–µ—Ç –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏ –≤ –º–µ—Ö–∞–Ω–∏–∑–º–∞—Ö –ø–æ–¥–ø–∏—Å–∫–∏/–æ—Ç–ø–∏—Å–∫–∏, –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–π –∏–ª–∏ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–π –ø–æ —Ä–æ–ª—è–º.
- Telegram-–±–æ—Ç –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –≤—Å–µ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º, —É–∫–∞–∑–∞–Ω–Ω—ã—Ö –≤ —Ç–∞–±–ª–∏—Ü–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π.
- –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –≥—Ä—É–ø–ø–∞–º–∏, —Ä–µ–≥–∏–æ–Ω–∞–º–∏, –∑–∞–ø—É—Å–∫ –ø–∞—Ä—Å–∏–Ω–≥–∞ –∏ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ ‚Äî –¥–æ—Å—Ç—É–ø–Ω–æ –ª—é–±–æ–º—É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é –ø—Ä–æ–µ–∫—Ç–∞.

--- 