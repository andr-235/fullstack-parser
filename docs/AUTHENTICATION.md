# Аутентификация

## Обзор

Система аутентификации предоставляет безопасный доступ к приложению через формы входа и регистрации. После рефакторинга структура была упрощена для лучшей поддерживаемости и UX.

## Компоненты

### LoginForm

Компонент формы входа с валидацией.

**Функции:**
- Валидация email и пароля
- Отображение ошибок
- Интеграция с NextAuth.js
- Защита от множественных отправок

**Props:**
- Нет (самодостаточный компонент)

### RegisterForm

Компонент формы регистрации с валидацией.

**Функции:**
- Валидация всех полей (имя, email, пароль, подтверждение)
- Проверка совпадения паролей
- Автоматический вход после успешной регистрации
- Отображение ошибок

**Props:**
- Нет (самодостаточный компонент)

## API Эндпоинты

### POST /api/v1/auth/register

Регистрация нового пользователя.

**Запрос:**
```json
{
  "email": "user@example.com",
  "password": "securepassword",
  "full_name": "John Doe"
}
```

**Ответ (успех):**
```json
{
  "message": "User registered successfully"
}
```

**Ответ (ошибка):**
```json
{
  "detail": "Email already exists"
}
```

## Middleware

Для защиты маршрутов используется Next.js middleware в `middleware.ts`.

**Защищенные маршруты:**
- `/dashboard` - требует аутентификации
- `/profile` - требует аутентификации
- `/admin` - требует роли администратора

## Валидация

### Правила валидации форм

- **Email:** Обязательное поле, валидный email формат
- **Пароль:** Минимум 8 символов, содержит буквы и цифры
- **Полное имя:** Обязательное поле, минимум 2 символа
- **Подтверждение пароля:** Должно совпадать с паролем

### UX Улучшения

- Реал-тайм валидация полей
- Четкие сообщения об ошибках
- Loading состояния во время отправки
- Доступность (ARIA labels, keyboard navigation)

## Тестирование

Тесты написаны с использованием Jest и React Testing Library.

**Покрытые сценарии:**
- Успешный вход/регистрация
- Ошибки валидации
- Сетевые ошибки
- Loading состояния
- Проверка совпадения паролей

## Безопасность

- CSRF защита через NextAuth.js
- Валидация входных данных
- Защита от brute force атак
- Безопасное хранение паролей (bcrypt)
- HTTPS обязательный

## Использование

### Вход

```tsx
import LoginForm from '@/components/LoginForm';

export default function LoginPage() {
  return <LoginForm />;
}
```

### Регистрация

```tsx
import RegisterForm from '@/components/RegisterForm';

export default function RegisterPage() {
  return <RegisterForm />;
}
```

### Защита маршрута

```tsx
// middleware.ts
import { withAuth } from 'next-auth/middleware';

export default withAuth(
  function middleware(req) {
    // Дополнительная логика
  },
  {
    callbacks: {
      authorized: ({ token }) => !!token,
    },
  }
);

export const config = {
  matcher: ['/dashboard/:path*', '/profile/:path*'],
};
```

## Архитектурные решения

- **Разделение компонентов:** LoginForm и RegisterForm как отдельные компоненты для лучшей переиспользуемости
- **Валидация на клиенте:** React Hook Form для лучшей UX
- **Централизованная аутентификация:** NextAuth.js для управления сессиями
- **Middleware защита:** Next.js middleware для защиты маршрутов на уровне сервера

## Будущие улучшения

- [ ] Двухфакторная аутентификация
- [ ] Социальный вход (Google, GitHub)
- [ ] Восстановление пароля
- [ ] Управление сессиями
- [ ] Логирование попыток входа