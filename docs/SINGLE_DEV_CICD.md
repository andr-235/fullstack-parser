# üöÄ –£–ø—Ä–æ—â—ë–Ω–Ω—ã–π CI/CD –¥–ª—è –æ–¥–Ω–æ–≥–æ —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–∞

## üìã –û–±–∑–æ—Ä

–≠—Ç–∞ —Å–∏—Å—Ç–µ–º–∞ CI/CD –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–∞ –¥–ª—è —Ä–∞–±–æ—Ç—ã –æ–¥–Ω–æ–≥–æ —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–∞. –£–±—Ä–∞–Ω—ã –ª–∏—à–Ω–∏–µ –ø—Ä–æ–≤–µ—Ä–∫–∏, —É–ø—Ä–æ—â—ë–Ω –ø—Ä–æ—Ü–µ—Å—Å –¥–µ–ø–ª–æ—è, –¥–æ–±–∞–≤–ª–µ–Ω—ã –±—ã—Å—Ç—Ä—ã–µ –∫–æ–º–∞–Ω–¥—ã.

## üéØ –û—Å–Ω–æ–≤–Ω—ã–µ –ø—Ä–∏–Ω—Ü–∏–ø—ã

- **–ë—ã—Å—Ç—Ä—ã–µ –ø—Ä–æ–≤–µ—Ä–∫–∏** - —Ç–æ–ª—å–∫–æ –∫—Ä–∏—Ç–∏—á–Ω—ã–µ —Ç–µ—Å—Ç—ã
- **–ü—Ä—è–º–æ–π –¥–µ–ø–ª–æ–π** - –±–µ–∑ staging, —Å—Ä–∞–∑—É –≤ production
- **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ —Ç–µ–≥–∏** - –ø–æ –∫–æ–º–º–∏—Ç–∞–º –≤ main
- **–ü—Ä–æ—Å—Ç–æ–π workflow** - –º–∏–Ω–∏–º—É–º —Å–ª–æ–∂–Ω–æ—Å—Ç–∏

## üöÄ –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç

### 1. –ó–∞–ø—É—Å–∫ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏

```bash
make dev
# –∏–ª–∏
docker compose up -d
```

### 2. –¢–µ—Å—Ç—ã

```bash
make test
# –∏–ª–∏
./scripts/quick-deploy.sh  # –≤–∫–ª—é—á–∞–µ—Ç —Ç–µ—Å—Ç—ã
```

### 3. –î–µ–ø–ª–æ–π –≤ production

```bash
make deploy
# –∏–ª–∏
./scripts/quick-deploy.sh
```

## üìÅ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ñ–∞–π–ª–æ–≤

```
.github/workflows/
‚îú‚îÄ‚îÄ simple-ci.yml          # –£–ø—Ä–æ—â—ë–Ω–Ω—ã–π CI/CD
‚îú‚îÄ‚îÄ ci.yml                 # –°—Ç–∞—Ä—ã–π —Å–ª–æ–∂–Ω—ã–π CI (–º–æ–∂–Ω–æ –æ—Ç–∫–ª—é—á–∏—Ç—å)
‚îî‚îÄ‚îÄ deploy-production.yml  # –°—Ç–∞—Ä—ã–π –¥–µ–ø–ª–æ–π (–º–æ–∂–Ω–æ –æ—Ç–∫–ª—é—á–∏—Ç—å)

scripts/
‚îî‚îÄ‚îÄ quick-deploy.sh        # –°–∫—Ä–∏–ø—Ç –±—ã—Å—Ç—Ä–æ–≥–æ –¥–µ–ø–ª–æ—è

Makefile.simple            # –£–ø—Ä–æ—â—ë–Ω–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã
```

## üîß –ö–æ–º–∞–Ω–¥—ã Makefile

### –û—Å–Ω–æ–≤–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã

```bash
make dev      # –ó–∞–ø—É—Å–∫ –≤ —Ä–µ–∂–∏–º–µ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏
make test     # –ë—ã—Å—Ç—Ä—ã–µ —Ç–µ—Å—Ç—ã
make build    # –°–±–æ—Ä–∫–∞ –æ–±—Ä–∞–∑–æ–≤
make deploy   # –î–µ–ø–ª–æ–π –≤ production
make status   # –°—Ç–∞—Ç—É—Å —Å–µ—Ä–≤–∏—Å–æ–≤
make logs     # –ü–æ–∫–∞–∑–∞—Ç—å –ª–æ–≥–∏
make clean    # –û—á–∏—Å—Ç–∫–∞ Docker
```

### Git –∫–æ–º–∞–Ω–¥—ã

```bash
make branch   # –°–æ–∑–¥–∞—Ç—å –Ω–æ–≤—É—é –≤–µ—Ç–∫—É
make commit   # –ö–æ–º–º–∏—Ç –∏–∑–º–µ–Ω–µ–Ω–∏–π
make push     # –ü—É—à –≤ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π
make pr       # –°–æ–∑–¥–∞—Ç—å Pull Request
```

## üîÑ Workflow

### –û–±—ã—á–Ω–∞—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∞

1. `make branch` - —Å–æ–∑–¥–∞—Ç—å –≤–µ—Ç–∫—É
2. –†–∞–∑—Ä–∞–±–æ—Ç–∫–∞
3. `make test` - –ø—Ä–æ–≤–µ—Ä–∏—Ç—å —Ç–µ—Å—Ç—ã
4. `make commit` - –∫–æ–º–º–∏—Ç
5. `make push` - –ø—É—à
6. `make pr` - —Å–æ–∑–¥–∞—Ç—å PR
7. Merge –≤ main

### –ë—ã—Å—Ç—Ä—ã–π –¥–µ–ø–ª–æ–π

1. –ü–µ—Ä–µ–∫–ª—é—á–∏—Ç—å—Å—è –Ω–∞ main: `git checkout main`
2. `./scripts/quick-deploy.sh` - –±—ã—Å—Ç—Ä—ã–π –¥–µ–ø–ª–æ–π
3. –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –¥–µ–ø–ª–æ–π —á–µ—Ä–µ–∑ GitHub Actions

## ‚ö° CI/CD Pipeline

### –¢—Ä–∏–≥–≥–µ—Ä—ã

- Push –≤ `main` ‚Üí –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –¥–µ–ø–ª–æ–π
- Push –≤ `develop` ‚Üí —Ç–æ–ª—å–∫–æ —Ç–µ—Å—Ç—ã
- Pull Request ‚Üí —Ç–æ–ª—å–∫–æ —Ç–µ—Å—Ç—ã

### –≠—Ç–∞–ø—ã

1. **–ë—ã—Å—Ç—Ä—ã–µ —Ç–µ—Å—Ç—ã** (10 –º–∏–Ω)

   - Backend: pytest —Å –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ–º –æ—à–∏–±–æ–∫
   - Frontend: Jest —Ç–µ—Å—Ç—ã

2. **–°–±–æ—Ä–∫–∞ –∏ –¥–µ–ø–ª–æ–π** (15 –º–∏–Ω)
   - –°–æ–∑–¥–∞–Ω–∏–µ —Ç–µ–≥–∞ (–¥–∞—Ç–∞ + –∫–æ–º–º–∏—Ç)
   - –°–±–æ—Ä–∫–∞ Docker –æ–±—Ä–∞–∑–æ–≤
   - –ü—É—à –≤ GitHub Container Registry
   - –î–µ–ø–ª–æ–π –Ω–∞ —Å–µ—Ä–≤–µ—Ä
   - –°–æ–∑–¥–∞–Ω–∏–µ GitHub Release

## üè∑Ô∏è –°–∏—Å—Ç–µ–º–∞ —Ç–µ–≥–æ–≤

–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ —Ç–µ–≥–∏ —Å–æ–∑–¥–∞—é—Ç—Å—è –≤ —Ñ–æ—Ä–º–∞—Ç–µ:

```
v20241201-a1b2c3d
```

–ì–¥–µ:

- `20241201` - –¥–∞—Ç–∞ (YYYYMMDD)
- `a1b2c3d` - –∫–æ—Ä–æ—Ç–∫–∏–π —Ö–µ—à –∫–æ–º–º–∏—Ç–∞

## üîß –ù–∞—Å—Ç—Ä–æ–π–∫–∞

### Secrets (—É–∂–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω—ã)

- `PRODUCTION_HOST` - IP —Å–µ—Ä–≤–µ—Ä–∞
- `PRODUCTION_USER` - –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å SSH
- `PRODUCTION_SSH_KEY` - SSH –∫–ª—é—á
- `PRODUCTION_APP_DIR` - –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—è –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
- `GHCR_USERNAME` - GitHub Container Registry
- `GHCR_TOKEN` - —Ç–æ–∫–µ–Ω –¥–ª—è GHCR
- `NEXT_PUBLIC_API_URL` - URL API –¥–ª—è frontend

### –û—Ç–∫–ª—é—á–µ–Ω–∏–µ —Å—Ç–∞—Ä–æ–≥–æ CI/CD

–ï—Å–ª–∏ —Ö–æ—á–µ—à—å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Ç–æ–ª—å–∫–æ —É–ø—Ä–æ—â—ë–Ω–Ω—É—é –≤–µ—Ä—Å–∏—é:

1. –ü–µ—Ä–µ–∏–º–µ–Ω—É–π —Å—Ç–∞—Ä—ã–µ —Ñ–∞–π–ª—ã:

```bash
mv .github/workflows/ci.yml .github/workflows/ci.yml.backup
mv .github/workflows/deploy-production.yml .github/workflows/deploy-production.yml.backup
```

2. –ü–µ—Ä–µ–∏–º–µ–Ω—É–π –Ω–æ–≤—ã–π —Ñ–∞–π–ª:

```bash
mv .github/workflows/simple-ci.yml .github/workflows/ci.yml
```

## üö® –û—Ç–∫–∞—Ç –¥–µ–ø–ª–æ—è

### –ë—ã—Å—Ç—Ä—ã–π –æ—Ç–∫–∞—Ç

```bash
# –ù–∞ —Å–µ—Ä–≤–µ—Ä–µ
cd /opt/app
docker compose -f docker-compose.prod.ip.yml up -d --build <PREVIOUS_TAG>
```

### –ß–µ—Ä–µ–∑ GitHub

1. –ü–µ—Ä–µ–π—Ç–∏ –≤ Releases
2. –ù–∞–π—Ç–∏ –ø—Ä–µ–¥—ã–¥—É—â–∏–π —Ä–µ–ª–∏–∑
3. –°–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å —Ç–µ–≥
4. –ó–∞–ø—É—Å—Ç–∏—Ç—å –¥–µ–ø–ª–æ–π —Å —ç—Ç–∏–º —Ç–µ–≥–æ–º

## üìä –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥

### GitHub Actions

- https://github.com/andr-235/fullstack/actions

### –°—Ç–∞—Ç—É—Å —Å–µ—Ä–≤–∏—Å–æ–≤

```bash
make status
# –∏–ª–∏
docker compose ps
```

### –õ–æ–≥–∏

```bash
make logs
# –∏–ª–∏
docker compose logs -f
```

## üéØ –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞

‚úÖ **–ë—ã—Å—Ç—Ä–æ—Ç–∞** - –¥–µ–ø–ª–æ–π –∑–∞ 15-20 –º–∏–Ω—É—Ç
‚úÖ **–ü—Ä–æ—Å—Ç–æ—Ç–∞** - –º–∏–Ω–∏–º—É–º –Ω–∞—Å—Ç—Ä–æ–µ–∫
‚úÖ **–ù–∞–¥—ë–∂–Ω–æ—Å—Ç—å** - –æ—Å–Ω–æ–≤–Ω—ã–µ –ø—Ä–æ–≤–µ—Ä–∫–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã
‚úÖ **–ê–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏—è** - —Ç–µ–≥–∏ –∏ —Ä–µ–ª–∏–∑—ã —Å–æ–∑–¥–∞—é—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏
‚úÖ **–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥** - –ø–æ–Ω—è—Ç–Ω—ã–µ –ª–æ–≥–∏ –∏ —Å—Ç–∞—Ç—É—Å—ã

## üîÑ –ú–∏–≥—Ä–∞—Ü–∏—è —Å–æ —Å—Ç–∞—Ä–æ–≥–æ CI/CD

1. –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä—É–π –Ω–æ–≤—ã–π workflow –Ω–∞ develop
2. –ü–µ—Ä–µ–∫–ª—é—á–∏—Å—å –Ω–∞ –Ω–æ–≤—ã–π workflow
3. –û—Ç–∫–ª—é—á–∏ —Å—Ç–∞—Ä—ã–µ —Ñ–∞–π–ª—ã
4. –û–±–Ω–æ–≤–∏ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—é –∫–æ–º–∞–Ω–¥—ã

## üÜò Troubleshooting

### –¢–µ—Å—Ç—ã –ø–∞–¥–∞—é—Ç

```bash
# –õ–æ–∫–∞–ª—å–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞
make test

# –î–µ—Ç–∞–ª—å–Ω—ã–µ –ª–æ–≥–∏
cd backend && poetry run pytest tests/ -v
cd frontend && pnpm test --verbose
```

### –î–µ–ø–ª–æ–π –Ω–µ –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è

1. –ü—Ä–æ–≤–µ—Ä—å —á—Ç–æ –≤ main –≤–µ—Ç–∫–µ
2. –ü—Ä–æ–≤–µ—Ä—å —á—Ç–æ –Ω–µ—Ç –Ω–µ–∑–∞–∫–æ–º–º–∏—á–µ–Ω–Ω—ã—Ö –∏–∑–º–µ–Ω–µ–Ω–∏–π
3. –ü—Ä–æ–≤–µ—Ä—å GitHub Actions

### –û–±—Ä–∞–∑—ã –Ω–µ —Å–æ–±–∏—Ä–∞—é—Ç—Å—è

```bash
# –õ–æ–∫–∞–ª—å–Ω–∞—è —Å–±–æ—Ä–∫–∞
make build

# –ü—Ä–æ–≤–µ—Ä–∫–∞ Docker
docker images | grep fullstack
```

## üìû –ü–æ–¥–¥–µ—Ä–∂–∫–∞

–ü—Ä–∏ –ø—Ä–æ–±–ª–µ–º–∞—Ö:

1. –ü—Ä–æ–≤–µ—Ä—å –ª–æ–≥–∏: `make logs`
2. –ü—Ä–æ–≤–µ—Ä—å —Å—Ç–∞—Ç—É—Å: `make status`
3. –û—á–∏—Å—Ç–∏ –∫—ç—à: `make clean`
4. –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏: `make dev`
