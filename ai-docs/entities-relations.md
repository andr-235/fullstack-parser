# Entities & Relations

Документ описывает основные бизнес-сущности проекта, их назначение и связи между ними.

---

## User (Пользователь)
- **Назначение:** Авторизация, управление доступом, аудит.
- **Поля:** email, full_name, hashed_password, is_active, is_superuser.
- **Связи:** Не связан напрямую с остальными сущностями (может использоваться для аудита и управления).

---

## VKGroup (Группа ВКонтакте)
- **Назначение:** Хранит информацию о VK-группе, которая мониторится.
- **Поля:** vk_id, screen_name, name, description, is_active, max_posts_to_check, статистика, метаданные VK.
- **Связи:**
  - Один ко многим: VKGroup → VKPost (у группы много постов)

---

## VKPost (Пост ВКонтакте)
- **Назначение:** Представляет пост в VK-группе.
- **Поля:** vk_id, vk_owner_id, text, group_id, published_at, likes_count, ...
- **Связи:**
  - Многие к одному: VKPost → VKGroup (каждый пост принадлежит одной группе)
  - Один ко многим: VKPost → VKComment (у поста много комментариев)

---

## VKComment (Комментарий ВКонтакте)
- **Назначение:** Представляет комментарий к посту VK.
- **Поля:** vk_id, text, post_id, author_id, published_at, likes_count, ...
- **Связи:**
  - Многие к одному: VKComment → VKPost (каждый комментарий принадлежит одному посту)
  - Один ко многим: VKComment → CommentKeywordMatch (связь с найденными ключевыми словами)
  - Самоссылка: VKComment → VKComment (parent_comment_id — для иерархии комментариев)

---

## Keyword (Ключевое слово)
- **Назначение:** Используется для фильтрации и поиска по комментариям.
- **Поля:** word, category, description, is_active, is_case_sensitive, ...
- **Связи:**
  - Один ко многим: Keyword → CommentKeywordMatch (одно ключевое слово может встречаться во многих комментариях)

---

## CommentKeywordMatch (Связь комментария и ключевого слова)
- **Назначение:** Фиксирует факт совпадения ключевого слова в комментарии.
- **Поля:** comment_id, keyword_id, matched_text, match_position, match_context, found_at.
- **Связи:**
  - Многие к одному: CommentKeywordMatch → VKComment
  - Многие к одному: CommentKeywordMatch → Keyword

---

## Основные связи между сущностями
- **VKGroup** ←1---*→ **VKPost** ←1---*→ **VKComment** ←1---*→ **CommentKeywordMatch** ←*---1→ **Keyword**
- **User** — изолированная сущность (используется для управления и аудита)

---

## Использование
- Для мониторинга добавляются VKGroup, далее парсятся VKPost и VKComment.
- Комментарии анализируются на наличие Keyword, совпадения фиксируются через CommentKeywordMatch.
- User управляет доступом и настройками системы.

Документ лаконичен и отражает только ключевые бизнес-сущности и их связи.
