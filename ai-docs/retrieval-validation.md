# Retrieval & Validation

Документ описывает, как данные извлекаются, валидируются и трансформируются в проекте (backend и frontend).

---

## Backend: Получение и обработка данных

### 1. Извлечение данных
- **ORM (SQLAlchemy):**
  - Данные извлекаются через асинхронные запросы (`select`, `filter`, `scalars().all()`, `scalar_one_or_none()`).
  - Пример: `await db.execute(select(Model).where(...))`
- **Сервисы:**
  - Вся бизнес-логика и доступ к данным инкапсулированы в сервисах (например, `BaseService`, `ParserService`).
  - Сервисы используют сессии БД и возвращают объекты моделей.
- **API:**
  - FastAPI endpoints принимают параметры, вызывают сервисы, возвращают схемы (Pydantic).

### 2. Валидация данных
- **Pydantic-схемы:**
  - Все входные и выходные данные проходят строгую валидацию через Pydantic (`Field`, типы, ограничения).
  - Пример: `email: EmailStr = Field(..., description="Email пользователя")`
  - Для создания/обновления используются отдельные схемы (`Create`, `Update`).
- **Валидация на уровне API:**
  - Проверка уникальности, существования, прав доступа, формата данных.
  - Ошибки возвращаются с HTTP-кодами и описанием.

### 3. Трансформация данных
- **Схемы (model_validate, model_dump):**
  - Модели преобразуются в схемы для возврата через API (`model_validate`, `model_dump`).
  - Преобразование дат, вложенных объектов, списков.
- **Бизнес-логика:**
  - В сервисах данные могут агрегироваться, фильтроваться, обогащаться дополнительной информацией.
  - Пример: подсчёт статистики, поиск ключевых слов, формирование вложенных структур.

---

## Frontend: Получение и обработка данных

### 1. Извлечение данных
- **API-клиент (axios):**
  - Все данные получаются через REST API (`api.getGroups()`, `api.getComments()`, ...).
  - Запросы типизированы, параметры передаются явно.
- **React Query:**
  - Для получения, кэширования и обновления данных используются хуки (`useQuery`, `useMutation`).
  - Пример: `useGroups(params)`

### 2. Валидация и типизация
- **TypeScript-типы:**
  - Все данные строго типизированы (интерфейсы в `types/api.ts`).
  - Ошибки API обрабатываются централизованно (interceptors).
- **Проверка на уровне UI:**
  - Валидация форм, обязательных полей, формата данных до отправки на сервер.

### 3. Трансформация данных
- **Маппинг и форматирование:**
  - Даты, числа, вложенные объекты форматируются для отображения.
  - Пример: преобразование дат в читаемый формат, агрегация статистики.
- **Преобразование для UI:**
  - Данные могут фильтроваться, сортироваться, группироваться на клиенте для удобства пользователя.

---

## Кратко
- Backend: асинхронный ORM, строгие схемы, сервисный слой, валидация и преобразование через Pydantic.
- Frontend: типизированные API-запросы, хуки, строгая типизация, валидация и трансформация для UI.

Документ лаконичен и отражает только основные этапы обработки данных.
