# Services

Документ описывает основные сервисы backend, их бизнес-логику, входные и выходные данные, а также правила использования.

---

## BaseService
- **Назначение:** Базовый CRUD-сервис для работы с моделями SQLAlchemy.
- **Бизнес-логика:** Универсальные операции: создание, получение, обновление, удаление сущностей.
- **Использование:** Наследуется специализированными сервисами (UserService, GroupService и др.).
- **Данные:**
  - **Вход:** Pydantic-схемы (Create/Update)
  - **Выход:** SQLAlchemy-модели

---

## UserService
- **Назначение:** Управление пользователями (регистрация, аутентификация, поиск).
- **Бизнес-логика:**
  - Создание пользователя с хешированием пароля
  - Аутентификация по email и паролю
  - Получение пользователя по email или id
- **Использование:** Через DI в API и других сервисах.
- **Данные:**
  - **Вход:** UserCreate, UserUpdate
  - **Выход:** User (модель)

---

## GroupService
- **Назначение:** Управление VK-группами (создание, поиск, обновление).
- **Бизнес-логика:**
  - Получение группы по screen_name или vk_id
  - CRUD-операции с VKGroup
- **Использование:** В API для работы с группами.
- **Данные:**
  - **Вход:** VKGroupCreate, VKGroupUpdate
  - **Выход:** VKGroup (модель)

---

## ParserService
- **Назначение:** Парсинг постов и комментариев VK, поиск ключевых слов.
- **Бизнес-логика:**
  - Получение постов и комментариев через VKBottleService
  - Поиск и сохранение совпадений по ключевым словам
  - Агрегация статистики парсинга
- **Использование:** В фоновых задачах и API парсера.
- **Данные:**
  - **Вход:** group_id, max_posts, force_reparse, callback
  - **Выход:** ParseStats (статистика)

---

## VKBottleService
- **Назначение:** Асинхронная работа с VK API через библиотеку VKBottle.
- **Бизнес-логика:**
  - Получение информации о группах, постах, комментариях
  - Обработка ошибок VK API
- **Использование:** В ParserService и API для интеграции с VK.
- **Данные:**
  - **Вход:** group_id, post_id, параметры VK API
  - **Выход:** Сырые данные VK (dict/list)

---

## RedisParserManager
- **Назначение:** Управление состоянием задач парсинга через Redis.
- **Бизнес-логика:**
  - Регистрация, обновление, завершение и остановка задач
  - Хранение прогресса и статистики задач
  - Получение состояния и истории задач
- **Использование:** В API парсера и фоновых задачах.
- **Данные:**
  - **Вход:** ParseTaskResponse, task_id, прогресс, ошибки
  - **Выход:** ParserState, ParseTaskResponse, ParserStats

---

## Arq Enqueue Service
- **Назначение:** Постановка задач парсинга в очередь Arq (Redis).
- **Бизнес-логика:**
  - Асинхронная отправка задач на выполнение воркерам
  - Передача параметров задачи (group_id, max_posts, force_reparse)
- **Использование:** В API парсера для запуска фоновых задач.
- **Данные:**
  - **Вход:** group_id, max_posts, force_reparse, job_id
  - **Выход:** Статус постановки задачи

---

## Кратко
- Все сервисы инкапсулируют бизнес-логику и работу с внешними системами (БД, VK API, Redis, очередь задач).
- Используются через DI в API и между собой.
- Входные данные — строго типизированные схемы; выходные — модели или структуры для API.

Документ лаконичен и отражает только суть сервисов и их взаимодействия. 